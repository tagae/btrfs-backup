#!/bin/bash

this=$(realpath "$0")
scripts=$(dirname "$this")

source "$scripts/btrfs-backup-lib.sh"

usage() {
    echo "Usage: $script <subvol> <pool> <store>" >&2
    exit 1
}

(( $# == 3 )) || usage

subvol=$1
pool=$2
store=$3

"$scripts"/btrfs-backup-snapshot "$subvol" "$pool"
"$scripts"/btrfs-backup-send "$pool" "$store"

"$scripts"/btrfs-backup-cleanup "$pool"
"$scripts"/btrfs-backup-cleanup "$store"
